---
phase: 11-bulgarian-content-and-ai-reports
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/subNicheConfig.ts
  - src/components/audit/Step1BusinessInfo.tsx
  - src/components/audit/Step2Technology.tsx
  - src/components/audit/Step3LeadFunnel.tsx
  - src/components/audit/Step7Operations.tsx
autonomous: true
requirements: [TRANS-04, TRANS-05]

must_haves:
  truths:
    - "Bulgarian user sees EUR-denominated revenue tiers in Step 1 (e.g., 'Под 25 000 €') instead of USD tiers"
    - "Bulgarian user sees Bulgarian-market platforms in lead sources (imot.bg, homes.bg, OLX.bg, bazar.bg)"
    - "Bulgarian user sees Viber in communication tools alongside WhatsApp"
    - "English user continues to see the original US-market options unchanged"
    - "Form values stored in state are stable scoring keys — translated labels do not break scoring"
  artifacts:
    - path: "src/config/subNicheConfig.ts"
      provides: "Bulgarian market option overrides per sub-niche group with language-conditional resolution"
      contains: "BG_SUB_NICHE_OPTIONS"
    - path: "src/components/audit/Step1BusinessInfo.tsx"
      provides: "Language-conditional revenue/GCI option arrays (USD for EN, EUR for BG)"
      contains: "BG_HS_REVENUES"
    - path: "src/components/audit/Step2Technology.tsx"
      provides: "Language-aware CRM and tools options"
      contains: "lang"
    - path: "src/components/audit/Step3LeadFunnel.tsx"
      provides: "Language-aware lead source options with Bulgarian platforms"
      contains: "lang"
  key_links:
    - from: "src/components/audit/Step1BusinessInfo.tsx"
      to: "src/lib/scoring.ts"
      via: "Revenue/GCI values are NOT in scoring lookup tables — safe to use different EUR strings for BG"
      pattern: "annualRevenue|annualGCI"
    - from: "src/components/audit/Step2Technology.tsx"
      to: "src/config/subNicheConfig.ts"
      via: "getSubNicheOptions() returns sub-niche-specific options; language layer adds BG market options"
      pattern: "getSubNicheOptions"
    - from: "src/components/audit/Step3LeadFunnel.tsx"
      to: "src/config/subNicheConfig.ts"
      via: "leadSources from getSubNicheOptions(), language layer adds BG platforms"
      pattern: "getSubNicheOptions"
---

<objective>
Add Bulgarian-market form options and EUR-denominated pricing tiers so that Bulgarian users see locally relevant platforms, tools, and revenue ranges throughout the audit form.

Purpose: Without market-specific options, Bulgarian users would see US-centric tools (ServiceTitan, Zillow), USD pricing ($250K-$500K), and miss key local platforms (imot.bg, OLX.bg, Viber). This plan implements the "shared base + local additions" framework from CONTEXT.md.

Output: Language-aware option resolution in Step1-3 and Step7, with Bulgarian-market platforms and EUR revenue tiers.
</objective>

<execution_context>
@C:/Users/Emil/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Emil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-bulgarian-content-and-ai-reports/11-CONTEXT.md
@.planning/phases/11-bulgarian-content-and-ai-reports/11-RESEARCH.md

# Source files
@src/config/subNicheConfig.ts
@src/components/audit/Step1BusinessInfo.tsx
@src/components/audit/Step2Technology.tsx
@src/components/audit/Step3LeadFunnel.tsx
@src/components/audit/Step7Operations.tsx
@src/components/audit/AuditFormComponents.tsx
@src/hooks/useLang.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Bulgarian market options to subNicheConfig and EUR revenue tiers to Step1</name>
  <files>src/config/subNicheConfig.ts, src/components/audit/Step1BusinessInfo.tsx</files>
  <action>
**Part A: subNicheConfig.ts — Bulgarian market option overrides**

Add a parallel `BG_SUB_NICHE_OPTIONS` config map (same shape as `SUB_NICHE_OPTIONS`) with Bulgarian-market-specific options. The "shared base + local additions" framework means: keep widely-used international tools, ADD Bulgarian platforms, REMOVE US-only platforms.

Export a function `getSubNicheOptionsForLang(subNiche: SubNiche, lang: string): SubNicheOptions` that returns:
- `lang === 'bg'` -> BG_SUB_NICHE_OPTIONS (with Bulgarian-market platforms)
- else -> SUB_NICHE_OPTIONS (existing English/US options)

**Bulgarian market option specifics (from research):**

1. **Lead sources** — the key differentiator:
   - BG HS reactive: "Google Търсене/SEO", "Google Ads", "Facebook/Instagram реклами", "OLX.bg", "bazar.bg", "Alo.bg", "Viber групи", "Препоръки от клиенти" (Word of Mouth)
   - BG HS recurring: Similar with "HOA" replaced by "Етажна собственост" partnerships
   - BG HS project_based: Replace "Houzz" with "OLX.bg", add "Facebook групи"
   - BG RE residential_sales: Replace "Zillow/Realtor.com" with "imot.bg", "imoti.net", "homes.bg", "address.bg"; add "OLX.bg"
   - BG RE commercial: Replace "CoStar/LoopNet" with "imot.bg Бизнес", "OLX.bg"
   - BG RE property_management: Replace "Zillow Rental Manager", "Apartments.com" with "imot.bg Наеми", "OLX.bg"
   - BG RE new_construction: Replace "Model Home Walk-Ins" with "Имотни изложения" (property exhibitions)
   - BG RE luxury_resort: Replace "International Property Portals" with "imot.bg Луксозни", "homes.bg"

   Lead source values are scored by array length only (not by specific string), so BG-specific values like "imot.bg" are safe. They also flow to AI formContext, which is desirable.

2. **CRM options** — CRM names are international platform names. Bulgarian businesses use international CRMs. Keep CRM lists largely the same; no Bulgarian-specific field service management software exists per research.

3. **Tools extra** — add "Viber" to toolsExtra for ALL BG sub-niche groups (Viber is the #1 messaging app in Bulgaria).

4. **KPIs** — keep as-is. KPI values are scoring-relevant (tracked KPI count matters). English values preserved for scoring consistency; display labels handled via translation files.

**Part B: Step1BusinessInfo.tsx — EUR revenue/GCI tiers**

Add language-conditional revenue and GCI option arrays for Bulgarian users. Use `useLang()` hook to get `lang`.

```typescript
// Bulgarian EUR-denominated tiers (from research)
const BG_HS_REVENUES = toOptions([
  "Под 25 000 €", "25 000 - 50 000 €", "50 000 - 100 000 €",
  "100 000 - 250 000 €", "250 000 - 500 000 €", "Над 500 000 €",
]);
const BG_RE_GCI = toOptions([
  "Под 15 000 €", "15 000 - 30 000 €", "30 000 - 60 000 €",
  "60 000 - 150 000 €", "Над 150 000 €",
]);
```

In the component, select options by language:
```typescript
const { lang } = useLang();
const revenueOptions = lang === 'bg' ? BG_HS_REVENUES : HS_REVENUES;
const gciOptions = lang === 'bg' ? BG_RE_GCI : RE_GCI;
```

Revenue/GCI values are NOT in scoring lookup tables (confirmed in research). They flow to AI prompt context and report hero display. EUR values are correct for Bulgarian users.

**Scope constraint:** Revenue and GCI are the ONLY fields needing different value strings for BG. All other dropdown options (response speed, lead tracking, scheduling method, etc.) keep English values as scoring keys. Their display labels come from bg/steps.json. Dropdown ANSWER option translation is intentionally deferred — matches the Phase 7 decision: "Option arrays (toOptions) intentionally untranslated — values are scoring keys."
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors. Verify that `getSubNicheOptionsForLang` is exported and callable. Check that Step1 renders different revenue options for 'bg' vs 'en'.
  </verify>
  <done>
- subNicheConfig.ts exports `BG_SUB_NICHE_OPTIONS` and `getSubNicheOptionsForLang(subNiche, lang)`
- BG lead sources include imot.bg, homes.bg, OLX.bg, bazar.bg for relevant sub-niches
- BG tools include Viber for all sub-niche groups
- Step1 shows EUR revenue tiers for Bulgarian users, USD for English
- Step2 and Step3 use language-aware option resolution
- Build passes with no TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Step2, Step3, and Step7 to use language-aware sub-niche options</name>
  <files>src/components/audit/Step2Technology.tsx, src/components/audit/Step3LeadFunnel.tsx, src/components/audit/Step7Operations.tsx</files>
  <action>
Update Step2, Step3, and Step7 to use the new `getSubNicheOptionsForLang(subNiche, lang)` function instead of `getSubNicheOptions(subNiche)`.

In each component:
1. Import `useLang` from `@/hooks/useLang`
2. Get `lang` from `useLang()`
3. Replace `getSubNicheOptions(state.subNiche)` with `getSubNicheOptionsForLang(state.subNiche, lang)`
4. Replace the import of `getSubNicheOptions` with `getSubNicheOptionsForLang`

**Step2Technology.tsx:**
```typescript
import { useLang } from "@/hooks/useLang";
import { getSubNicheOptionsForLang } from "@/config/subNicheConfig";
// ...
const { lang } = useLang();
const subNicheOpts = state.subNiche ? getSubNicheOptionsForLang(state.subNiche, lang) : null;
```

**Step3LeadFunnel.tsx:**
Same pattern — replace `getSubNicheOptions` with `getSubNicheOptionsForLang`, add `useLang`.

**Step7Operations.tsx:**
Same pattern for KPI options.

Also add the base (non-sub-niche) lead source lists for Bulgarian. When no sub-niche is selected (shouldn't happen since sub-niche is required, but defensive), the base lists are used. For BG, create BG-specific base lists that include Bulgarian platforms:
- BG base HS lead sources: Include OLX.bg, bazar.bg, Facebook Marketplace/Groups, Google Search/SEO, Google Ads, Word of Mouth, Viber groups
- BG base RE lead sources: Include imot.bg, imoti.net, homes.bg, OLX.bg, Facebook, Google

These base lists are fallbacks. Add language-conditional base list selection in Step3:
```typescript
const leadSourceOptions = subNicheOpts && subNicheOpts.leadSources.length > 0
  ? toOptions(subNicheOpts.leadSources)
  : (isHS ? (lang === 'bg' ? BG_HS_LEAD_SOURCES : HS_LEAD_SOURCES) : (lang === 'bg' ? BG_RE_LEAD_SOURCES : RE_LEAD_SOURCES));
```

Define BG base lead source arrays in Step3 alongside the existing EN ones.
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors. Verify `getSubNicheOptionsForLang` is used in all 3 step components. Confirm no references to the old `getSubNicheOptions` remain in step components (it can still exist in subNicheConfig.ts for backward compatibility).
  </verify>
  <done>
- Step2, Step3, Step7 use `getSubNicheOptionsForLang(subNiche, lang)` for language-aware option resolution
- Bulgarian users see Bulgarian-market platforms in lead sources and tools
- English users see the original US-market options unchanged
- Build passes
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Step1 renders EUR revenue tiers when lang === 'bg', USD when lang === 'en'
3. Step2 CRM options include appropriate tools for BG market when lang === 'bg'
4. Step3 lead sources include imot.bg, OLX.bg for BG real estate sub-niches
5. Step7 KPI options resolve correctly per language
6. English experience is identical to pre-Phase 11 (no regressions)
</verification>

<success_criteria>
- Bulgarian market options (imot.bg, homes.bg, OLX.bg, bazar.bg, Viber) appear for BG users
- EUR revenue/GCI tiers with Bulgarian formatting appear for BG users
- English users see unchanged US-market options
- Scoring is not affected (English values preserved where scoring depends on them)
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-bulgarian-content-and-ai-reports/11-02-SUMMARY.md`
</output>
