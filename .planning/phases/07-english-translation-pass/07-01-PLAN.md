---
phase: 07-english-translation-pass
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/i18n.ts
  - src/locales/en/translation.json
  - src/locales/bg/translation.json
  - public/locales/en/landing.json
  - public/locales/en/common.json
  - public/locales/en/steps.json
  - public/locales/en/generating.json
  - public/locales/en/report.json
  - src/@types/i18next.d.ts
  - package.json
  - src/pages/Index.tsx
autonomous: true
requirements:
  - TRANS-06

must_haves:
  truths:
    - "i18next loads namespaces from public/locales/en/ via i18next-http-backend at runtime"
    - "Five JSON namespaces exist: landing.json, common.json, steps.json, generating.json, report.json"
    - "The landing page (Index.tsx) renders identically to pre-Phase-7 using t() calls from the landing namespace"
    - "The fallback translation.json files in src/locales/ are removed or emptied — all strings served from namespaces"
    - "npm run build succeeds with zero errors"
  artifacts:
    - path: "src/lib/i18n.ts"
      provides: "i18next initialization with i18next-http-backend and multiple namespaces"
      contains: "i18next-http-backend"
    - path: "public/locales/en/landing.json"
      provides: "All landing page English strings"
      contains: "hero"
    - path: "public/locales/en/common.json"
      provides: "Shared strings (nav, buttons, validation, brand)"
      contains: "nav"
    - path: "public/locales/en/steps.json"
      provides: "Empty skeleton for step strings (populated in 07-03/07-04)"
    - path: "public/locales/en/generating.json"
      provides: "Empty skeleton for generating page strings (populated in 07-05)"
    - path: "public/locales/en/report.json"
      provides: "Empty skeleton for report page strings (populated in 07-05)"
    - path: "src/@types/i18next.d.ts"
      provides: "Updated TypeScript declarations for namespaced resources"
    - path: "src/pages/Index.tsx"
      provides: "Landing page using t() calls instead of hardcoded strings"
      contains: "useTranslation"
  key_links:
    - from: "src/lib/i18n.ts"
      to: "public/locales/en/"
      via: "i18next-http-backend loadPath"
      pattern: "loadPath.*public/locales"
    - from: "src/pages/Index.tsx"
      to: "public/locales/en/landing.json"
      via: "useTranslation('landing')"
      pattern: "useTranslation.*landing"
---

<objective>
Restructure i18n from inline translation.json bundles to namespace-based JSON files loaded via i18next-http-backend from `public/locales/en/`. Then extract all hardcoded strings from the landing page (Index.tsx) into the `landing` namespace.

Purpose: This is the foundation plan for Phase 7 — establishes the namespace structure that all subsequent extraction plans will populate. The landing page extraction validates the end-to-end flow (JSON file -> i18next -> t() call -> rendered text).
Output: Working namespace-based i18n config, 5 namespace JSON files (landing populated, others as skeletons), landing page fully using t() calls.
</objective>

<execution_context>
@C:/Users/Emil/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Emil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-english-translation-pass/07-CONTEXT.md
@src/lib/i18n.ts
@src/locales/en/translation.json
@src/pages/Index.tsx
@src/@types/i18next.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install i18next-http-backend and restructure i18n config</name>
  <files>
    package.json
    src/lib/i18n.ts
    public/locales/en/landing.json
    public/locales/en/common.json
    public/locales/en/steps.json
    public/locales/en/generating.json
    public/locales/en/report.json
    src/locales/en/translation.json
    src/locales/bg/translation.json
    src/@types/i18next.d.ts
  </files>
  <action>
1. Install i18next-http-backend: `npm install i18next-http-backend`

2. Create `public/locales/en/common.json` — shared strings used across multiple pages:
   ```json
   {
     "brand": {
       "name": "E&P Systems",
       "initials": "E&P",
       "tagline": "AI-Powered Business Growth Solutions"
     },
     "nav": {
       "freeAuditTool": "Free AI Business Audit Tool"
     },
     "buttons": {
       "next": "Next Step",
       "back": "Back",
       "backToHome": "Back to Home",
       "save": "Save Progress",
       "saved": "Saved!",
       "generateReport": "Generate My AI Audit Report",
       "startNewAudit": "Start a New Audit",
       "share": "Share",
       "copied": "Copied!",
       "downloadPdf": "Download PDF",
       "retry": "Retry",
       "skipToReport": "Skip to Report",
       "refreshPage": "Refresh Page"
     },
     "validation": {
       "fixFollowing": "Please fix the following:",
       "businessNameRequired": "Business name is required",
       "nameRequired": "Your name is required",
       "emailRequired": "Email address is required",
       "emailInvalid": "Please enter a valid email address",
       "crmRequired": "Please select your primary CRM or software",
       "crmSatisfactionRequired": "Please rate your satisfaction with your current software",
       "leadSourceRequired": "Please select at least one lead source",
       "responseSpeedRequired": "Please select your lead response speed"
     },
     "niche": {
       "hs": "Home Services & Trades",
       "re": "Real Estate Teams & Brokerages",
       "hsShort": "Home Services & Trades",
       "reShort": "Real Estate"
     },
     "stepOf": "Step {{current}} of {{total}}",
     "copyright": "\u00a9 {{year}} E&P Systems \u00b7 AI-Powered Business Growth Solutions"
   }
   ```

3. Create `public/locales/en/landing.json` — all landing page strings:
   ```json
   {
     "partner": {
       "referredBy": "Referred by Partner: {{code}}"
     },
     "hero": {
       "badge": "FREE \u00b7 AI-POWERED \u00b7 PERSONALIZED",
       "title": "Get Your Free",
       "titleHighlight": "AI Business Audit",
       "subtitle": "Answer a few questions about your business and we'll generate a personalized report showing <strong>exactly where you're leaving money on the table</strong> \u2014 and how to fix it.",
       "subtitleStrong": "exactly where you're leaving money on the table"
     },
     "benefits": [
       "Discover exactly where you're losing money",
       "Get a personalized AI-generated score for 7 business areas",
       "Receive actionable recommendations you can implement immediately",
       "Compare your performance to industry benchmarks",
       "Takes only 8\u201310 minutes to complete"
     ],
     "stats": {
       "categoriesScored": {
         "value": "7",
         "label": "Business Categories Scored"
       },
       "avgTime": {
         "value": "~8 min",
         "label": "Avg. Time to Complete"
       },
       "aiReport": {
         "value": "Free",
         "label": "AI-Generated Report"
       }
     },
     "nicheSelect": {
       "prompt": "Select your business type to get started:",
       "hs": {
         "title": "Home Services & Trades",
         "description": "HVAC, Plumbing, Electrical, Roofing, Landscaping, Pest Control, and more",
         "tags": ["HVAC", "Plumbing", "Electrical", "Roofing", "Landscaping", "More"],
         "cta": "Start My Audit"
       },
       "re": {
         "title": "Real Estate Teams & Brokerages",
         "description": "Agents, teams, brokerages, property management, and mortgage teams",
         "tags": ["Residential", "Teams", "Brokerages", "Property Mgmt", "Mortgage", "More"],
         "cta": "Start My Audit"
       }
     },
     "howItWorks": {
       "title": "How It Works",
       "steps": [
         {
           "step": "01",
           "title": "Answer 8 Quick Sections",
           "description": "Tell us about your technology, leads, operations, and financials. Takes about 8 minutes."
         },
         {
           "step": "02",
           "title": "AI Analyzes Your Answers",
           "description": "Our AI scores your business across 7 critical categories and benchmarks you against industry standards."
         },
         {
           "step": "03",
           "title": "Get Your Personalized Report",
           "description": "Receive your full audit report with scores, critical gaps, quick wins, and strategic recommendations."
         }
       ]
     }
   }
   ```

4. Create empty skeleton files for remaining namespaces:
   - `public/locales/en/steps.json`: `{}`
   - `public/locales/en/generating.json`: `{}`
   - `public/locales/en/report.json`: `{}`

5. Update `src/lib/i18n.ts` to use i18next-http-backend:
   ```typescript
   import i18n from 'i18next';
   import { initReactI18next } from 'react-i18next';
   import HttpBackend from 'i18next-http-backend';

   // URL-driven language detection: "URL is king"
   const firstSegment = window.location.pathname.split('/')[1];
   const initialLng = firstSegment === 'en' ? 'en' : 'bg';

   i18n
     .use(HttpBackend)
     .use(initReactI18next)
     .init({
       lng: initialLng,
       fallbackLng: 'en',
       ns: ['common', 'landing', 'steps', 'generating', 'report'],
       defaultNS: 'common',
       backend: {
         loadPath: '/locales/{{lng}}/{{ns}}.json',
       },
       interpolation: {
         escapeValue: false,
       },
     });

   export default i18n;
   ```
   **Key changes:**
   - Added HttpBackend (replaces inline JSON imports)
   - Changed `fallbackLng` from `'bg'` to `'en'` — English is now the fallback since English is the only language with complete translation files. Bulgarian translations will come in Phase 11
   - Defined 5 namespaces with `common` as default
   - `loadPath` points to `/locales/{{lng}}/{{ns}}.json` (Vite serves `public/` at root)
   - Removed static `resources` object — backend loads on demand

6. Create `public/locales/bg/common.json` with minimal keys so Bulgarian doesn't crash on missing files:
   ```json
   {
     "brand": {
       "name": "E&P Systems",
       "initials": "E&P"
     }
   }
   ```
   Also create empty `public/locales/bg/landing.json`, `public/locales/bg/steps.json`, `public/locales/bg/generating.json`, `public/locales/bg/report.json` as `{}`.

7. Remove (or empty) the old translation files:
   - Delete `src/locales/en/translation.json` contents, replace with `{}` (or delete if safe)
   - Delete `src/locales/bg/translation.json` contents, replace with `{}` (or delete if safe)
   - Keep the directories/files for now to avoid breaking any stale imports. Claude's discretion on whether to fully delete them.

8. Update `src/@types/i18next.d.ts` for namespace-based type safety:
   ```typescript
   import 'i18next';
   import type common from '../../public/locales/en/common.json';
   import type landing from '../../public/locales/en/landing.json';

   declare module 'i18next' {
     interface CustomTypeOptions {
       defaultNS: 'common';
       resources: {
         common: typeof common;
         landing: typeof landing;
       };
     }
   }
   ```
   Note: Only type common and landing for now. Add steps/generating/report types as their JSON files get populated in later plans.
  </action>
  <verify>
- `npm run build` succeeds
- `public/locales/en/` contains 5 JSON files: common.json, landing.json, steps.json, generating.json, report.json
- `public/locales/bg/` contains corresponding empty/minimal JSON files
- `src/lib/i18n.ts` uses HttpBackend and defines 5 namespaces
- The old `src/locales/` translation files are emptied or removed
  </verify>
  <done>i18n restructured from inline bundles to namespace-based HTTP backend loading from public/locales/. Five namespaces defined (common, landing, steps, generating, report). Landing and common JSON files populated with all required English strings. Bulgarian skeleton files created to prevent loading errors.</done>
</task>

<task type="auto">
  <name>Task 2: Extract all landing page strings to t() calls</name>
  <files>
    src/pages/Index.tsx
  </files>
  <action>
1. Add `useTranslation` import: `import { useTranslation } from 'react-i18next';`

2. Inside the `Index` component, add: `const { t } = useTranslation('landing');`
   Also add a second hook for common strings: `const { t: tc } = useTranslation('common');`

3. Replace every hardcoded string in the component with `t()` or `tc()` calls. The key mapping:

   **Header:**
   - `"E&P"` → `tc('brand.initials')`
   - `"E&P Systems"` → `tc('brand.name')`
   - `"Free AI Business Audit Tool"` → `tc('nav.freeAuditTool')`

   **Partner badge:**
   - `` `Referred by Partner: ${partnerCode}` `` → `t('partner.referredBy', { code: partnerCode })`

   **Hero badge:**
   - `"FREE · AI-POWERED · PERSONALIZED"` → `t('hero.badge')`

   **Hero heading:**
   - `"Get Your Free "` → `t('hero.title')`
   - `"AI Business Audit"` → `t('hero.titleHighlight')`

   **Hero subtitle:** This contains embedded JSX (`<strong>`). Use splitting approach:
   - Replace the paragraph content with: `t('hero.subtitle')` — but since it contains a `<strong>` tag, use the `Trans` component from react-i18next:
     ```tsx
     import { useTranslation, Trans } from 'react-i18next';
     ```
     Then:
     ```tsx
     <Trans
       i18nKey="hero.subtitle"
       ns="landing"
       components={{ strong: <strong className="text-white" /> }}
     />
     ```
     And update the JSON string to use `<strong>` tags: `"Answer a few questions about your business and we'll generate a personalized report showing <strong>exactly where you're leaving money on the table</strong> — and how to fix it."`

   **Benefits list:**
   - Replace the `benefits` const array with: `const benefits = t('benefits', { returnObjects: true }) as string[];`

   **Stats:**
   - Replace inline objects with t() lookups:
     ```tsx
     { value: t('stats.categoriesScored.value'), label: t('stats.categoriesScored.label') }
     { value: t('stats.avgTime.value'), label: t('stats.avgTime.label') }
     { value: t('stats.aiReport.value'), label: t('stats.aiReport.label') }
     ```

   **Niche selection:**
   - `"Select your business type to get started:"` → `t('nicheSelect.prompt')`
   - HS card title, description, tags, CTA → `t('nicheSelect.hs.title')`, `t('nicheSelect.hs.description')`, `t('nicheSelect.hs.tags', { returnObjects: true }) as string[]`, `t('nicheSelect.hs.cta')`
   - RE card same pattern with `nicheSelect.re.*`

   **How it works:**
   - `"How It Works"` → `t('howItWorks.title')`
   - Steps array → `const howSteps = t('howItWorks.steps', { returnObjects: true }) as Array<{step: string; title: string; description: string}>;`

   **Footer:**
   - Copyright text → `tc('copyright', { year: new Date().getFullYear() })`

4. Remove the static `benefits` const at module level — it's now loaded from JSON.

5. Handle the Suspense boundary: Since i18next-http-backend loads asynchronously, wrap the component usage with React Suspense or add `react: { useSuspense: false }` to the i18n init config. **Preferred approach:** Add `react: { useSuspense: false }` to i18n init (in the i18n.ts changes from Task 1) so that components render without Suspense wrappers. Translations will be empty on first frame then fill in — acceptable for SPA.

   Alternatively, if `useSuspense: false` causes flash-of-untranslated-content, use `Suspense` with a minimal fallback at the App level. Claude's discretion.
  </action>
  <verify>
- `npm run build` succeeds
- `npm run dev` — landing page renders identically to pre-Phase-7
- No hardcoded English strings remain in Index.tsx (except brand strings if delegated to common namespace)
- Browser DevTools Network tab shows `/locales/en/landing.json` and `/locales/en/common.json` being fetched
- All text on landing page matches pre-Phase-7 exactly (no missing strings, no broken interpolation)
  </verify>
  <done>Landing page (Index.tsx) fully converted to t() calls. All user-visible text comes from landing.json and common.json namespaces. The page renders identically to pre-Phase-7 in English.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run test` passes
3. `npm run dev` — landing page looks identical to pre-Phase-7 (visually compare hero, benefits, stats, niche cards, how-it-works, footer)
4. Browser Network tab shows namespace JSON files being loaded
5. No hardcoded English strings remain in Index.tsx
6. Visiting `/en/` shows the landing page in English via t() calls
7. Visiting `/` shows the landing page (Bulgarian fallback to English since BG translations not yet done)
</verification>

<success_criteria>
- i18next uses HttpBackend loading from public/locales/ with 5 namespaces
- Landing page (Index.tsx) uses t() calls for ALL user-visible text
- The landing page renders identically to pre-Phase-7 in English
- common.json contains shared brand, nav, button, and validation strings
- landing.json contains all landing-page-specific strings
- Remaining namespace files exist as empty skeletons ready for population
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-english-translation-pass/07-01-SUMMARY.md`
</output>
