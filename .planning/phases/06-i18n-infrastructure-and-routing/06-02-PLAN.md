---
phase: 06-i18n-infrastructure-and-routing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/audit/AuditFormComponents.tsx
  - src/components/audit/Step1BusinessInfo.tsx
  - src/components/audit/Step2Technology.tsx
  - src/components/audit/Step3LeadFunnel.tsx
  - src/components/audit/Step4Scheduling.tsx
  - src/components/audit/Step5Communication.tsx
  - src/components/audit/Step6FollowUp.tsx
  - src/components/audit/Step7Operations.tsx
  - src/components/audit/Step8Financial.tsx
autonomous: true
requirements:
  - I18N-05

must_haves:
  truths:
    - "StyledSelect accepts options as Array<{value, label}> and stores the value string on change"
    - "MultiCheckbox accepts options as Array<{value, label}>, selected contains value strings, displays labels"
    - "All 8 step files compile and render identically to before (value === label in English)"
    - "Scoring engine lookups are unaffected — stored form values are the same English strings as before"
  artifacts:
    - path: "src/components/audit/AuditFormComponents.tsx"
      provides: "SelectOption type, refactored StyledSelect and MultiCheckbox"
      exports: ["SelectOption", "StyledSelect", "MultiCheckbox"]
      contains: "SelectOption"
    - path: "src/components/audit/Step1BusinessInfo.tsx"
      provides: "Step 1 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step2Technology.tsx"
      provides: "Step 2 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step3LeadFunnel.tsx"
      provides: "Step 3 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step4Scheduling.tsx"
      provides: "Step 4 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step5Communication.tsx"
      provides: "Step 5 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step6FollowUp.tsx"
      provides: "Step 6 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step7Operations.tsx"
      provides: "Step 7 using {value, label} API"
      contains: "value:"
    - path: "src/components/audit/Step8Financial.tsx"
      provides: "Step 8 using {value, label} API"
      contains: "value:"
  key_links:
    - from: "src/components/audit/Step2Technology.tsx"
      to: "src/components/audit/AuditFormComponents.tsx"
      via: "import SelectOption type + StyledSelect/MultiCheckbox"
      pattern: "SelectOption"
    - from: "src/components/audit/AuditFormComponents.tsx"
      to: "src/lib/scoring.ts"
      via: "stored value strings match scoring lookup keys"
      pattern: "value:"
---

<objective>
Refactor StyledSelect and MultiCheckbox components to accept `{value, label}` option objects instead of plain strings, and update all 8 step file call sites to use the new API while keeping stored values identical.

Purpose: This is the critical scoring-safety change — when Bulgarian labels are added in Phase 7, stored form values must remain English strings so scoring lookups never break. This refactor MUST happen before any translation work.
Output: New `SelectOption` type, refactored components, all 8 step files updated.
</objective>

<execution_context>
@C:/Users/Emil/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Emil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-i18n-infrastructure-and-routing/06-RESEARCH.md
@src/components/audit/AuditFormComponents.tsx
@src/lib/scoring.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor StyledSelect and MultiCheckbox to {value, label} API</name>
  <files>
    src/components/audit/AuditFormComponents.tsx
  </files>
  <action>
1. Add new exported type at the top of the file (after imports):
   ```typescript
   export interface SelectOption {
     value: string;   // English scoring key — always stored in state
     label: string;   // Displayed text — changes per language in Phase 7
   }
   ```

2. Refactor `StyledSelect` component:
   - Change `options` prop type from `string[]` to `SelectOption[]`
   - Update the map: `options.map((opt) => <option key={opt.value} value={opt.value}>{opt.label}</option>)`
   - The `value` prop (current selection) and `onChange` callback remain `string` — they deal with the value side only

3. Refactor `MultiCheckbox` component:
   - Change `options` prop type from `string[]` to `SelectOption[]`
   - `selected` prop stays `string[]` — it holds value strings
   - Update `toggle` function to accept `value: string` (not the full option)
   - Update the map: compare `selected.includes(opt.value)`, toggle on `opt.value`, display `opt.label`
   - Specifically:
     ```typescript
     const toggle = (value: string) => {
       if (selected.includes(value)) {
         onChange(selected.filter((s) => s !== value));
       } else {
         onChange([...selected, value]);
       }
     };
     ```
     And in the JSX map:
     ```typescript
     {options.map((opt) => {
       const isSelected = selected.includes(opt.value);
       return (
         <label key={opt.value} onClick={() => toggle(opt.value)} ...>
           ...
           <span ...>{opt.label}</span>
         </label>
       );
     })}
     ```

4. Export `SelectOption` from the file so step files can import it if needed.
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit` (will show errors in step files — expected, fixed in Task 2)
- `SelectOption` interface is exported
- `StyledSelect` accepts `options: SelectOption[]`
- `MultiCheckbox` accepts `options: SelectOption[]`
  </verify>
  <done>StyledSelect and MultiCheckbox accept `{value, label}` objects. Value is stored on change; label is displayed. The API is ready for Phase 7 to pass translated labels while keeping English values.</done>
</task>

<task type="auto">
  <name>Task 2: Update all 8 step file call sites to {value, label} API</name>
  <files>
    src/components/audit/Step1BusinessInfo.tsx
    src/components/audit/Step2Technology.tsx
    src/components/audit/Step3LeadFunnel.tsx
    src/components/audit/Step4Scheduling.tsx
    src/components/audit/Step5Communication.tsx
    src/components/audit/Step6FollowUp.tsx
    src/components/audit/Step7Operations.tsx
    src/components/audit/Step8Financial.tsx
  </files>
  <action>
For ALL 8 step files, apply the same pattern:

**Strategy:** Convert the existing `string[]` constant arrays into `SelectOption[]` arrays. Since we are still English-only in Phase 6, `value === label` for every option. Phase 7 will replace labels with `t()` calls.

**Conversion helper:** Create a local utility at the top of AuditFormComponents.tsx (or inline in each step file if simpler):
```typescript
// Helper to convert string arrays to SelectOption arrays (Phase 6 bridge)
const toOptions = (strings: string[]): SelectOption[] =>
  strings.map(s => ({ value: s, label: s }));
```

**For each step file:**

1. Import `SelectOption` from `./AuditFormComponents` (add to existing import)
2. Convert each `string[]` constant to `SelectOption[]` using the `toOptions` helper. Either:
   - **Option A (preferred):** Define `toOptions` locally in the step file and wrap existing arrays: `const HS_CRMS = toOptions(["ServiceTitan", "Housecall Pro", ...])` — this is the lowest-risk change
   - **Option B:** Manually convert each array to object notation — higher risk of typos

3. All `StyledSelect` and `MultiCheckbox` call sites should now pass `SelectOption[]` arrays without changing the `value` or `onChange` props.

**File-by-file scope (approximate call sites):**
- Step1BusinessInfo.tsx: ~11 StyledSelect (HS/RE employee counts, revenue, years, etc.)
- Step2Technology.tsx: 1 StyledSelect (CRM), 1 MultiCheckbox (tools)
- Step3LeadFunnel.tsx: 1 MultiCheckbox (lead sources), ~7 StyledSelect
- Step4Scheduling.tsx: ~12 StyledSelect
- Step5Communication.tsx: ~12 StyledSelect
- Step6FollowUp.tsx: ~12 StyledSelect
- Step7Operations.tsx: ~7 StyledSelect, 1 MultiCheckbox
- Step8Financial.tsx: ~8 StyledSelect, 2 MultiCheckbox

**CRITICAL verification:** After conversion, the stored values in form state must be IDENTICAL to before. Do not change any `onChange` handler or `value` binding — only the `options` prop type changes.

**Anti-pattern to avoid:** Do NOT change the `const` arrays to use different string values than before. The exact strings must match what the scoring engine expects in `src/lib/scoring.ts`.
  </action>
  <verify>
- `npm run build` succeeds with zero errors
- `npm run test` passes (if any tests exist for form components)
- Manually verify: each step file's `string[]` constants are now wrapped in `toOptions()` or equivalent
- Spot-check: `StyledSelect` and `MultiCheckbox` calls no longer pass bare `string[]`
- Grep for `options={[` or `options={HS_` to confirm all call sites use the new API
  </verify>
  <done>All 8 step files pass SelectOption[] arrays to StyledSelect and MultiCheckbox. Stored form values are unchanged English strings. The app renders and behaves identically to before — only the component API has changed to support future translated labels.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run test` passes
3. Run app with `npm run dev` — navigate through Steps 1-8 — all dropdowns and checkboxes render and function as before
4. Verify form state in localStorage (`ep_audit_state_form`) stores the same English string values as before
5. Grep check: no remaining `options: string[]` type in StyledSelect or MultiCheckbox
</verification>

<success_criteria>
- SelectOption type is exported from AuditFormComponents.tsx
- StyledSelect and MultiCheckbox accept SelectOption[] (not string[])
- All 8 step files compile and pass SelectOption[] to these components
- Form values stored in state are identical English strings — scoring is unaffected
- The UI renders identically to v1.0 (no visual regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/06-i18n-infrastructure-and-routing/06-02-SUMMARY.md`
</output>
